<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon" />
    <title>I'm Hades</title>

    <link rel="stylesheet" href="css/bootstrap-5.0.2-dist/bootstrap.min.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />

    <style>
      body {
        background: #222d32;
        font-family: "Roboto", sans-serif;
      }

      .login-box {
        margin-top: 75px;
        height: auto;
        background: #1a2226;
        text-align: center;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
      }

      .login-key {
        height: 100px;
        font-size: 80px;
        line-height: 100px;
      }

      .login-icon {
        color: #0db8de;
      }

      .login-title {
        margin-top: 15px;
        text-align: center;
        font-size: 30px;
        letter-spacing: 2px;
        margin-top: 15px;
        font-weight: bold;
        color: #ecf0f5;
      }

      .login-form {
        margin-top: 25px;
        text-align: left;
      }

      input[type="text"] {
        background-color: #1a2226;
        border: none;
        border-bottom: 2px solid #0db8de;
        border-top: 0px;
        border-radius: 0px;
        font-weight: bold;
        outline: 0;
        margin-bottom: 20px;
        padding-left: 0px;
        color: #ecf0f5;
      }

      input[type="password"] {
        background-color: #1a2226;
        border: none;
        border-bottom: 2px solid #0db8de;
        border-top: 0px;
        border-radius: 0px;
        font-weight: bold;
        outline: 0;
        padding-left: 0px;
        margin-bottom: 20px;
        color: #ecf0f5;
      }

      .form-group {
        margin-bottom: 40px;
        outline: 0px;
      }

      .form-control:focus {
        border-color: inherit;
        -webkit-box-shadow: none;
        box-shadow: none;
        border-bottom: 2px solid #0db8de;
        outline: 0;
        background-color: #1a2226;
        color: #ecf0f5;
      }

      input:focus {
        outline: none;
        box-shadow: 0 0 0;
      }

      label {
        margin-bottom: 0px;
      }

      .form-control-label {
        font-size: 10px;
        color: #6c6c6c;
        font-weight: bold;
        letter-spacing: 1px;
      }

      .btn-outline-primary {
        border-color: #0db8de;
        color: #0db8de;
        border-radius: 0px;
        font-weight: bold;
        letter-spacing: 1px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
      }

      .btn-outline-primary:hover {
        background-color: #0db8de;
        right: 0px;
      }

      .login-text {
        text-align: left;
        padding-left: 0px;
        color: #a2a4a4;
      }
    </style>
    <link rel="stylesheet" href="css/toast.css" />
    <script src="js/vue.min.js"></script>
    <script src="js/jquery-3.7.0.min.js"></script>
    <script src="js/jquery.toast.min.js"></script>
    <script src="js/bootstrap-5.0.2-dist/bootstrap.min.js"></script>
  </head>
  <body>
    <div class="container" id="app">
      <div class="row">
        <div class="col-lg-3 col-md-2"></div>
        <div class="col-lg-6 col-md-8 login-box">
          <div class="col-lg-12 login-key">
            <i class="fa fa-key login-icon" aria-hidden="true"></i>
          </div>
          <div class="col-lg-12 login-title">ADMIN PANEL</div>

          <div class="col-lg-12 login-form">
            <div class="col-lg-12 login-form">
              <form @submit="handleSubmit">
                <div class="form-group">
                  <label class="form-control-label">PASSWORD</label>
                  <input
                    type="password"
                    class="form-control"
                    v-model="password"
                    required
                  />
                </div>

                <div class="p-0 d-flex justify-content-center">
                  <button type="submit" class="btn btn-outline-primary mb-3">
                    LOGIN
                  </button>
                </div>
              </form>
            </div>
          </div>
          <div class="col-lg-3 col-md-2"></div>
        </div>
      </div>
    </div>

    <script type="module">
      new Vue({
        el: "#app",
        data() {
          return {
            password: "",
            count: Number(localStorage.getItem("loginAttempt") || 0),
          };
        },
        methods: {
          handleSubmit(e) {
            e.preventDefault();
            fetch("/api/signin", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ password: this.password }),
            })
              .then((res) => res.json())
              .then((res) => {
                if (typeof res === "string") {
                  localStorage.setItem("token", res);
                  localStorage.setItem("loginAttempt", 0);
                  document.cookie = `token=${res}`;
                  $.toast({
                    heading: "Success",
                    text: "Welcome Hades. Loading admin page...",
                    showHideTransition: "slide",
                    icon: "success",
                  });
                  setTimeout(() => {
                    location.href = "/admin";
                  }, 3000);
                } else {
                  $.toast({
                    heading: "Failure",
                    text: "Something went wrong! Please try again.",
                    showHideTransition: "slide",
                    icon: "error",
                  });
                  // this.count++;
                  // localStorage.setItem("loginAttempt", this.count);
                  // if (this.count === 5) {
                  //   setInterval(function () {}, 1000);
                  // }
                }
              });
          },
        },
        watch: {
          count: {
            handler(count) {
              //   if (count > 5 || count < 35) {
              // this.count++;
              // localStorage.setItem("loginAttempt", this.count);
              //   }
            },
          },
        },
      });
    </script>
  </body>
</html>
